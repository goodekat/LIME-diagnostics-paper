
## To Do

  - Move all code and results from our work identifying the data to my
    LIME-research-journals repo for future reference (including LIME
    explanations from different training datasets/models)
  - Update 02-data-preparation.Rmd to only include the preparation of
    the CCFs\_withlands data to be used in the paper
  - Update code/figures in paper to train a random forest using
    CCFs\_withlands data (and a set seed) and apply LIME predictions
  - Rewrite Section 4 as needed
  - Prepare for submission
  - Edit dataset descriptions in README and add to the readme.txt
    document for submission
  - Upload the files for submission and submit

# LIME Diagnostics Manuscript

<img src="figure-static/figure-readme.png" width="3600" />

This repository contains the files associated with the manuscript
“Visual Diagnostics of a Model Explainer – Tools for the Assessment of
LIME Explanations” by Katherine Goode and Heike Hofmann. The rest of
this readme contains:

  - information about the files in the repository,
  - instructions for knitting the manuscript,
  - descriptions of the bullet data used in the manuscript, and
  - information on the font sizes used for the figures in the
    manuscript.

## Description of Items in Repository

The contents of the folders and main directory are described below:

**`code`**

Contains the R code associated with the manuscript that is not directly
included in `paper.Rnw` (such as some external data cleaning and file
organization):

  - `data-preparation.Rmd` contains R code for preparing the raw bullet
    data (bullet training data, bullet testing data, and example
    matching signatures) to be used in the manuscript and saves zip
    versions of the data sets to be uploaded to GitHub
  - `figure-compression.Rmd` contains R code for compressing the static
    figure used in the manuscript to be uploaded to GitHub
  - `submission-steps.Rmd` contains the to do list and R code for
    preparing the files for submission to the ASA Data Science Journal.

**`cover-letter`**

Contains the files associated with the cover letter submitted to the ASA
Data Science journal.

**`data`**

Contains the data used to generate the manuscript:

  - `bullet-test.csv.zip` and `bullet-test.csv.zip` contain the data
    used for the bullet examples in the manuscript. Additional
    information about these files is included below under the heading
    “Additional Information on Bullet Data”.
  - `example-signatures.csv.zip` contains signature data from two
    matching bullet lands that is used to generate a figure in the
    manuscript.
  - `raw` contains the raw versions of the data files (from Heike and
    CSAFE) that the above datasets are derived from. *Do not alter the
    data in these files.*

**`figure-static`**

Contains the static figures associated with the project:

  - `figure-08-1.png.zip` is the one figure in the manuscript that is
    not generated using R code.
  - `figure-readme.png` is a figure used in the readme.

**`old-version`**

Contains the files associated with an old version of the manuscript that
is much longer the the submitted version

**`submission`**

Contains the files submitted to the ASA Data Science Journal. These
files are moved to this folder using code in the file
`code/submission-steps.R`. The only figures not included on GitHub are
the EPS figures that are submitted due to size constraints.

**Main Directory**

  - `.gitignore` contains objects to be ignored by git.
  - `paper.Rnw`, `paper.pdf`, and `paper.tex` are the manuscript. Note
    that `paper.pdf` and `paper.tex` are generated by `paper.Rnw`.
  - `README.Rmd` and `README.md` are the readme files that generated
    this output.
  - `readme.txt` contains descriptions of the data files that are
    included with the submission
  - `references.bib` contains the bibtex information for the references
    in the manuscript
  - `WileyNJG-AMS.bst` and `WileyNJG-v2.cls` contain the latex
    formatting specifications for the ASA Data Science Journal.

## Instructions for Knitting Manuscript

When the manuscript is knit, various files will be generated (such as
`data-bullet-explain.rds` and `figure-10-1.png`). The first time the
manuscript is knit, it will take a while (possibly up to several hours).
Once these files have been generated during the first knit, the
manuscript will take much less time to knit (approximately a few
minutes).

Follow these instructions to knit the manuscript:

1.  Pull the repository from GitHub.
2.  Install R packages [goodekat/lime](https://github.com/goodekat/lime)
    and [goodekat/limeaid](https://github.com/goodekat/limeaid) from
    GitHub using the remotes R package. (Note that goodekat/lime is a
    forked versions of
    [thomasp85/lime](https://github.com/thomasp85/lime) with minor
    changes to extract objects for the analysis in the manuscript.)

<!-- end list -->

``` r
remotes::install_github("goodekat/lime")
remotes::install_github("goodekat/limeaid")
```

3.  Knit manuscript (via the `paper.Rnw` file).

## Additional Information on Bullet Data

The data used in the manuscript for the bullet comparison examples is
described below. Note that this text is also included in the file
readme.txt that is submitted with the manuscript.

**`bullet-train`**

A dataset with 83028 rows and 14 columns that contains comparison
features based on high resolution microscopy scans of fired bullets from
Hamby sets 173 and 252 \[@hamby\]. This dataset is created from the x3p
scans of bullet land engraved areas available from the [NIST Ballistics
Toolmark Research Database](https://tsapps.nist.gov/NRBTD/). It contains
comparisons from 408 bullet-land signatures. 12 of the overall 420 lands
(6 lands per bullets, 35 bullets in each set) are excluded from the
comparison. Six of these lands show so-called “tank rash” - damage to
the bullets after it exited the barrel (see [tank rash
scans](LEAscans/tankrash.md)). Another bullet (Bullet E from Hamby 173)
is excluded because it could not be matched visually to the barrel it
was supposedly from (see [scans from bullet E](LEAscans/bullete.md)).
The <b>bullet\_train</b> data is based on a set of features extracted
from the x3p scans as described in @hare:2016. The raw file of
comparison features is found [here](data/raw/hamby-comparisons.csv.zip).
The only changes made to the data were XXX I think the following
statement needs to be adjusted XXX to select only variables of use for
the manuscript, add a case variable, rename `same_source` as
`samesource`, and attach the random forest scores associated with the
comparisons. The variables in the data are as follows:

#### Variables used as key variables:

  - case: ID number associated with the bullet-land signature
    comparison.
  - land\_id1, land\_id2: IDs describing the two land engraved areas in
    the comparison. The format is ‘study-barrel number -bullet
    number-land number’.

#### Comparison features

  - ccf: maximized cross-correlation between two LEA signatures.
  - rough\_cor: correlation after detrending aligned signatures.
  - D: Euclidean distance (in millimeters) between two aligned
    signatures.
  - sd\_D: standard deviation of the previous measure along the
    signature.
  - matches, mismatches: number of matching/non-matching peaks and
    valleys in the aligned signatures.
  - cms: consecutively matching striae is a measure introduced by
    @biasotti describing the longest run of matching peaks between two
    aligned signatures.
  - non\_cms: the number of consecutively non-matching peaks.
  - sum\_peaks: the depth of peaks measured as the sum of matching peaks
    between two aligned signatures (in microns).
  - samesource: ground truth whether a pair is from the same source
    (`TRUE`) or from different sources (`FALSE`).
  - rfscore: the random forest score associated with the comparison in
    support of a match.

<!--For further details about the signatures comparison features, see XXX.-->

**`bullet-test`**

A dataset with 364 rows and 14 columns that contains comparison features
from test sets 1 and 11 of the Hamby 224 Clone sets. Each test set is
arranged as a combination of three bullets: two known bullets and a
questioned bullet. Similar to the training set, each bullet has 6 lands.
The data contains comparisons of bullet-lands within a set. With three
bullets with six lands per set, there are a total of (2 sets) x (3\!
bullet comparisons) x (6^2 land comparisons) = 432 comparisons. However,
there are only 364 comparisons in the `bullet-test` data. This is due to
the fact that some of the lands are missing from the data (due to tank
rash): land 4 from the unknown bullet in set 1, land 2 from bullet 1 in
set 11, and land 4 from the unknown bullet in set 11. The variables in
the test data are the same as the training data described above.

<!-- For further details about the signatures comparison features, see XXX.-->

**`example-signatures`**

Contains the signature data from aligned signatures of two bullet-lands
from the same source. The variables in the data are as follows:

  - land: Indicator variable whether the observation corresponds to
    ‘Signature 1’ or ‘Signature 2’
  - x: the (relative) x position of the signature (in microns)
  - y: the (relative) y position of the signature height (in microns)

## Figure Font Size Information

The font sizes in the figures are calculated based on how the figures
are scaled due to the specification of both fig.width and out.width in
the Rnw file to ensure that they are consistent across figures. The text
sizes are either set to 7 pt or 5.5 pt (Helvetica) as indicated by the
table below. Note that the text in the manuscript is 9 pt (Times) and a
similar approach was used to ensure that line sizes are larger than 0.5
pt.

| Part of Graphic                                          | Font Size |
| -------------------------------------------------------- | --------- |
| Title                                                    | 7 pt      |
| Subtitle                                                 | 7 pt      |
| Axis labels                                              | 7 pt      |
| Facet labels that act as x-axis or y-axis labels         | 7 pt      |
| Facet labels that act as titles for lime R package plots | 7 pt      |
| Legend titles                                            | 7 pt      |
| Interior labels (such as those created using geom\_text) | 7 pt      |
| Axis tick labels                                         | 5.5 pt    |
| Facet labels (general)                                   | 5.5 pt    |
| Legend labels                                            | 5.5 pt    |

Note: The only figure that does not follow these values is Figure 11
where the facet labels were set to font size 5 (Helvetica) in order for
them to fit appropriately.
