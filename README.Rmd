---
output: rmarkdown::github_document
always_allow_html: yes
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

## To Do

- Figure out discrepancies with old and new versions of the training data
- Rerun the lime explanations with the finalized training data
- Edit dataset descriptions in README and add to the readme.txt document for submission
- Update all files in the submission folder
- Finish filling in questions in ASA submission document
- Upload the files for submission and submit

# LIME Diagnostics Paper

```{r echo = FALSE}
knitr::include_graphics("figure-readme.png")
```

This repository contains the files associated with the paper "Visual Diagnostics of a Model Explainer -- Tools for the Assessment of LIME Explanations" by Katherine Goode and Heike Hofmann. The rest of this readme contains:

- information about the files in the repository,
- instructions for knitting the paper,
- descriptions of the bullet data used in the paper, 
- information on the font sizes used for the figures in the manuscript, and
- the steps taken to create the `submission` folder.

## Description of Items in Repository

**Folders**

- `old-version` contains the files associated with an old version of the paper that is much longer the the submitted version.
- `submission` contains all of the files submitted to the ASA data science journal. Note that the paper is specified slightly different in this folder in order to meet the requirements of the ASA data science journal. These are as follows:
  - The figure path in the .Rnw saves the generated figures in the main folder (instead of a figures folder).

**Files**

- `code-file-organization.R` contains R code for organizing the files to be added to the GitHub repository and generating a file with code for submission.
- `code-paper.R` contains the R code extracted from `paper.Rnw` using code in `code-file-organization.R`.
- `code-trim-sig-data.R` contains R code for preparing the data in the file `data-example-signatures.csv.zip` based on data provided by Heike (that are not included in this directory).
- `data-bullet-test.csv.zip` and `data-bullet-test.csv.zip` contain the data used for the bullet examples in the paper. Additional information about these files is included below under the heading "Additional Information on Bullet Data".
- `data-example-signatures.csv.zip` contains signature data from two matching bullet lands that is used to generate a figure in the manuscript.
- `figure-08-1.png.zip` is the one figure in the manuscript that is not generated using R code.
- `figure-readme.png` is a figure used in the readme.
- `.gitignore` contains objects to be ignored by git.
- `paper.Rnw`, `paper.pdf`, and `paper.tex` are the manuscript. Note that `paper.pdf` and `paper.tex` are generated by `paper.Rnw`.
- `README.Rmd` and `README.md` are the readme files that generated this output. :)
- `references.bib` contains the bibtex information for the 
- `WileyNJG-AMS.bst` and `WileyNJG-v2.cls` contain the latex formatting specifications for the ASA data science journal.

## Instructions for Knitting Paper

When the paper is knit, various files will be generated (such as `data-bullet-explain.rds` and `figure-10-1.png`). The first time the paper is knit, it will take a while (approximately 45 minutes on Katherine's computer). Once these files have been generated during the first knit, the paper will take much less time to knit (approximately 1 minute on Katherine's computer).

Follow these instructions to knit the paper:

1. Pull the repository from GitHub.
2. Unzip all .zip files in the repository (`data-bullet-train.csv.zip`, `data-bullet-test.csv.zip`, `data-example-signatures.csv.zip`, and `figure-08-1.png.zip`).
3. Install R packages goodekat/lime and goodekat/limeaid from GitHub using devtools. (Note that goodekat/lime is a forked versions of thomasp85/lime with minor changes to extract objects for the analysis in the manuscript.)

```{r eval = FALSE}
devtools::install_github("goodekat/lime")
devtools::install_github("goodekat/limeaid")
```

4. Knit paper (via the paper.Rnw file).

## Additional Information on Bullet Data

The data used in the manuscript for the bullet comparison examples is described below.

`data-bullet-train`: Contains comparison features from the Hamby 173 and 252 sets.

`data-bullet-test`: Contains comparison features from the Hamby 224 Clone sets. As with all Hamby sets, Hamby set 224, is a collection of 35 bullets, organized as 20 known bullets and 15 questioned bullets. The known bullets are fired in pairs of two through one of ten consecutively manufactures P-85 barrels. Clone set 224 is arranged as a test set of fifteen tests, one for each questioned bullet. Each test set is arranged as a combination of three bullets: two known bullets and a questioned bullet. The test asks for a decision on whether the questioned bullet comes from the same source as the two known bullets or from a different source. This situation is similar to what a firearms and toolmarks examiner might encounter in case work. 

`data-example-signatures`: Contains the signature data from two bullet-lands that are a match. The variables in the data are as follows:

  - land = Indicates where the observation corresponds to 'Signature 1' or 'Signature 2'
  - x = The x position of the signature
  - sig = The y position of the signature

## Figure Font Size Information

The font sizes in the figures are calculated based on how the figures are scaled due to the specification of both fig.width and out.width in the Rnw file to ensure that they are consistent across figures. The text sizes are either set to 7 pt or 5.5 pt as indicated by the table below. Note that the text in the manuscript is 9 pt and a similar approach was used to ensure that line sizes are larger than 0.5 pt.

| Part of Graphic | Font Size |
| --------------- | --------- | 
| Title | 7 pt |
| Subtitle | 7 pt |
| Axis labels | 7 pt |
| Facet labels that act as x-axis or y-axis labels | 7 pt |
| Facet labels that act as titles for lime R package plots | 7 pt |
| Legend titles | 7 pt |
| Interior labels (such as those created using geom_text) | 7 pt |
| Axis tick labels | 5.5 pt |
| Facet labels (general) | 5.5 pt |
| Legend labels | 5.5 pt |

## Steps Followed to Create the Submission Folder

Follow these steps to make sure all guidelines are met for submission.

1. Knit the file `paper.Rnw` (to make sure everything is up to date).
2. Run the code in the file `code-file-organization.R` for producing an R script with all of the code from the manuscript (paper.Rnw).
3. Move the following files to the `submission` folder:
    - `code-paper.R`
    - `data-bullet-test.csv`
    - `data-bullet-train.csv`
    - `data-example-signatures.csv`
    - `figure/figure-XX-1.eps` (for XX = 01-07, 09, 11-13, B1, B2, and C3)
    - `figure-08-1.eps`
    - `figure-10-1.eps`
    - `paper.tex`
    - `readme.txt`
    - `references.bib`
    - `WileyNJD-AMS.bst`
    - `WileyNJD-v1.csl`
4. Change the name of `paper.tex` to `paper-submission.tex`.
5. Delete `figure/` from the figure file paths in `paper-submission.tex`. For example, change \includegraphics[width=6.5in]{figure/figure-01-1} to \includegraphics[width=6.5in]{figure-01-1}.
6. Compile the file `paper-submission.tex` (using LaTex, then bibTex, then LaTeX twice more) to make sure it compiles correctly. 
7. Besides for `paper-submission.pdf`, delete all other files generated when `paper-sumbission.tex` was compiled. This includes other `paper-submission` files and pdf versions of the figures.
8. Convert the following files in the submission folder to a zip file, call it `code-and-data.zip`, and then delete the unzipped versions of the files:
    - `code-paper.R`
    - `data-bullet-test.csv`
    - `data-bullet-train.csv`
    - `data-example-signatures.csv`
    - `readme.txt`
9. Upload all remaining files to ASA data science journal submission page (except for `paper-submission.Rnw`) which should be:
    - `code-and-data.zip`
    - `figure-01-1.eps` through `figure-C3-1.eps`
    - `paper-sumbission.pdf`
    - `paper-sumbission.tex`
    - `references.bib`
    - `WileyNJD-AMS.bst`
    - `WileyNJD-v2.cls`
  